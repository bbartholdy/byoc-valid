## Metagenomic analysis

```{r}
#| label: results-metagen-setup
#| include: false
removed_samples <- dna_metadata %>%
  mutate(rm = if_else(`#SampleID` %in% dna_analysis_metadata$`#SampleID`, F, T),
         col = case_when(rm == T ~ "red",
                         rm == F ~ "black")) %>% # colour coded names if needed
  mutate(sample = `#SampleID`)

# convert species table to long format
species_counts_long <- otu_table %>%
  pivot_longer(cols = where(is.numeric), names_to = "sample", values_to = "count") %>%
  rename(species = `#OTU ID`) %>%
  filter(sample %in% dna_analysis_metadata$`#SampleID`)

# collapse species counts into genus counts
genus_counts_long <- species_counts_long %>%
  mutate(genus = str_extract(species, "\\w+")) %>%
  group_by(sample, genus) %>%
  summarise(count = sum(count)) %>% 
  group_by(sample) %>%
  mutate(rel_abund = count / sum(count)) %>%
  ungroup()

# table containing the oxygen tolerance of species
species_properties <- bac_properties %>%
  right_join(species_counts_long, by = "species") %>%
  mutate(genus = str_extract(species, "\\w+")) %>%
  left_join(
    rename(genus_oxytol, genus_oxytol = `Oxygen tolerance`), by = "genus"
    ) %>%
  mutate(`Oxygen tolerance` = case_when(
    is.na(`Oxygen tolerance`) ~ genus_oxytol, # if no species-level info available
    TRUE ~ `Oxygen tolerance`)
    ) %>%
  group_by(sample) %>%
  mutate(
    abs = if_else(is.na(abs), FALSE, abs), # is ABS species? TRUE/FALSE
    rel_abund = count / sum(count)
    ) %>%
  ungroup()

# convert alpha diversity data to long format
alpha_div_long <- alpha_div %>%
  pivot_longer(cols = where(is.numeric), names_to = "index") %>%
  left_join(dna_metadata, by = c("sample" = "#SampleID")) %>%
  left_join(dna_experiment_metadata, by = c("sample" = "#SampleID", "Env")) %>%
  mutate(day_grouped = case_when( # group days to increase sample size
    day < 6 ~ "inoc",
    day > 6 & day < 24 ~ "treatm",
    day == 24 ~ "final"),
    day_grouped = factor(day_grouped, levels = c("inoc", "treatm", "final"))
    )

# summary stats for alpha diversity in experiment
alpha_summ_byoc <- alpha_div_long %>%
  filter(
    str_detect(sample, "SYN") # isolate samples from this study
    ) %>%
  group_by(index, day_grouped) %>% # group by sample type
  summarise(mean = mean(value),
            sd = sd(value))


# summary stats for grouped samples by Env
alpha_summ_all <- alpha_div_long %>%
  filter(
    Env != "skin",
    Env != "sediment",
    Env != "stool",
    Env != "indoor_air") %>%
  group_by(index, Env) %>%
  summarise(mean = mean(value),
            sd = sd(value))

# sPCA analyses

byoc_explain_var <- spca_byoc$prop_expl_var$X # experiment samples
# projection of samples onto PCs
byoc_princomp <- spca_byoc$x %>% # experiment samples
  as_tibble(rownames = "sample") %>%
  left_join(dna_experiment_metadata, by = c("sample" = "#SampleID"))
# loadings of species
byoc_pca_loadings <- spca_byoc$loadings$X %>% # experiment samples
  as_tibble(rownames = "species") %>%
  #left_join(bac_properties, by = "species") %>% 
  left_join(species_properties, by = "species") %>% 
  dplyr::select(species,PC1,PC2, `Oxygen tolerance`) %>%
  arrange(desc(abs(PC1))) %>%
  distinct(species, .keep_all = T)

compar_explain_var <- spca_species$prop_expl_var$X # comparative samples
# projection of samples onto PCs
compar_princomp <- spca_species$x %>% # comparative samples
  as_tibble(rownames = "sample") %>%
  left_join(dna_metadata, by = c("sample" = "#SampleID"))
compar_pca_loadings <- spca_species$rotation %>% # comparative samples
  as_tibble(rownames = "species") %>%
  left_join(species_properties, by = "species") %>% 
  dplyr::select(species,PC1,PC2,PC3,`Oxygen tolerance`) %>%
  arrange(desc(abs(PC1))) %>% 
  distinct(species, .keep_all = T)

# byoc-spca-plot-setup
# set common ggplot theme for loading plots
loading_theme <-  theme_minimal() +
    theme(
      panel.grid.major.x = element_blank(),
      panel.grid.minor.x = element_blank(),
      panel.grid.major.y = element_blank(),
      axis.ticks.x.bottom = element_line(size = 1),
      axis.text.y = element_text(),
      axis.text.x = element_text(vjust = -0.2),
      axis.line.x = element_line(),
      legend.position = "bottom"
          )
# helper objects to set x-axis limits
min_byoc_PC1 <- min(byoc_pca_loadings$PC1)
min_byoc_PC2 <- min(byoc_pca_loadings$PC2)
max_byoc_PC1 <- max(byoc_pca_loadings$PC1)
max_byoc_PC2 <- max(byoc_pca_loadings$PC2)
min_comp_PC1 <- min(compar_pca_loadings$PC1)
min_comp_PC2 <- min(compar_pca_loadings$PC2)
max_comp_PC1 <- max(compar_pca_loadings$PC1)
max_comp_PC2 <- max(compar_pca_loadings$PC2)

# differential abundance
```

### Sample authentication

<!-- SourceTracker -->
The sources of taxa were estimated using SourceTracker2 [@knightsSourceTracker2011].
The results suggest that the majority of taxa across samples have an oral microbial
signature. SourceTracker2 results were compared to a database of oral taxa
[@fellowsyatesEvolutionChanging2021] to prevent removal of samples where oral taxa
were assigned to a non-oral source, as some similar taxa with a signature from
multiple sources are often classified as "Unknown" [@velskoMicrobialDifferences2019].
A few samples suspected of containing a large proportion of contamination
were removed
(`r paste(filter(removed_samples, rm == T)$sample, collapse = ",")`). The removed
samples were predominantly medium samples from later in the experiment, and a few
model calculus samples (see Supp mat).

### Decrease in community diversity across experiment

```{r}
shan_byoc <- alpha_summ_byoc %>% 
  filter(index == "shannon") # isolate shannon index values
```


```{r}
#| label: fig-shannon-byoc
alpha_div_long %>%
  filter(str_detect(sample, "SYN"),
         index == "shannon") %>%
  #mutate(day = as.factor(day)) %>%
  ggplot(aes(x = day_grouped, y = value)) +
    geom_violin(aes(col = day_grouped, fill = day_grouped), alpha = 0.5) +
    geom_boxplot(width = 0.12) +
    #facet_wrap(~ index, scales = "free_y") +
    theme_bw() +
    theme(
      axis.title = element_blank(),
      #axis.text.x = element_blank(),
      axis.ticks.x = element_blank(),
      legend.position = "none"
    )
```

<!-- species diversity -->
We used the Shannon Index to assess the species diversity and richness in our
samples over the course of the experiment. There was a slight decrease in mean
alpha diversity between inoculation
(M = `r filter(shan_byoc, day_grouped == "inoc")$mean`, sd = `r filter(shan_byoc, day_grouped == "inoc")$sd`)
and treatment and final samples
(M = `r filter(shan_byoc, day_grouped == "treatm")$mean`, `r filter(shan_byoc, day_grouped == "treatm")$sd`; `r filter(shan_byoc, day_grouped == "final")$mean`, `r filter(shan_byoc, day_grouped == "final")$sd`),
as well as a decrease in variance within samples types (@fig-shannon-byoc).
Based on the similarity of distribution between Pielou's Species Evenness and the
Shannon index, the main driver of differences is likely the species richness <!-- insert link to Supp Mat-->(Supp. Mat).

### Medium and model calculus samples are distinct from the inoculate

```{r}
#| label: byoc-spca-fig-setup
byoc_spca_plot <- byoc_princomp %>%
  ggplot(aes(
    x = PC1, y = PC2, 
    col = as_factor(day),
    shape = Env
    )
  ) +
    geom_point(size = 4, stroke = 1) +
    labs(
      x = paste(
        "PC1", 
        scales::percent(byoc_explain_var[[1]], accuracy = 0.1)),
      y = paste(
        "PC2", 
        scales::percent(byoc_explain_var[[2]], accuracy = 0.1)),
      col = "Sampling day",
      shape = "Sample type"
      ) +
    theme_bw() +
    scale_shape_discrete(solid = F) +
    scale_colour_viridis_d()

byoc_comp_1 <- byoc_pca_loadings %>%
  arrange(desc(PC1)) %>% 
  mutate(species = fct_reorder(species, desc(PC1))) %>%
   slice(c(
    1:20,
    seq(from = nrow(byoc_pca_loadings)-19, to = nrow(byoc_pca_loadings))
    )) %>%
  ggplot(aes(x = PC1, y = species, fill = `Oxygen tolerance`)) +
    geom_bar(stat = "identity", width = 0.8) +
    scale_x_continuous(limits = c(min_byoc_PC1,max_byoc_PC1)) +
    scale_fill_manual(
      values = viridisLite::turbo(
        n = length(levels(as.factor(bac_properties$`Oxygen tolerance`)))
        )
      ) +
    labs(title = "component 1", x = "") +
    loading_theme

byoc_comp_2 <- byoc_pca_loadings %>%
  arrange(desc(PC2)) %>%
  mutate(species = fct_reorder(species, desc(PC2))) %>%
   slice(c(
    1:20,
    seq(from = nrow(byoc_pca_loadings)-19, to = nrow(byoc_pca_loadings))
    )) %>%
  ggplot(aes(x = PC2, y = species, fill = `Oxygen tolerance`)) +
    geom_bar(stat = "identity", width = 0.8) +
    scale_x_continuous(limits = c(min_byoc_PC2,max_byoc_PC2)) +
  scale_fill_manual(
      values = viridisLite::turbo(
        n = length(levels(as.factor(bac_properties$`Oxygen tolerance`)))
        )
      ) +
    labs(title = "component 2", x = "") +
    loading_theme
```

```{r}
#| label: spca-byoc-plot
#| fig-cap: "sPCA on species-level counts from experiment samples only."
byoc_spca_plot
byoc_comp_1
byoc_comp_2 #+ plot_layout(guides = "collect", ncol = 2) + plot_annotation(tag_levels = "A")
```

The species profiles of the saliva inoculate used in our experiment were
distinct from both medium and model calculus samples. Most of the separation
is on PC1 of the sPCA, with minimal separation on PC2. Most of the model
calculus samples also cluster separately from the medium samples on PC2.
The largest negative loadings on PC1, separating inoculate from other samples, are an
abundance of aerobes and facultative anaerobes in the inoculate, especially
*Rothia* and *Neisseria* spp. Conversely, positive loadings consist mainly of
anaerobes, especially *Selenomonas* spp.

```{r}
#| label: fig-diffabund-byoc
#| fig-cap: "Log-fold changes between sample types. Circles are species enriched in the model calculus, squares are enriched in saliva, and triangles in medium. Plot shows the top 20 absolute log-fold changes between model calculus and other sample types."
byoc_logf_full %>% 
  group_by(env) %>% 
  arrange(desc(abs(lfc))) %>%
  slice_head(n = 30) %>% # causes loss of some env values
  ungroup() %>%
  arrange(desc(abs(lfc))) %>%
  slice_head(n = 30) %>% # extract top 20 lfc from modern_calculus
  bind_rows(filter( # recombine with other env values so all are included in plot
    byoc_logf_full, 
    env != "saliva",
    species %in% .$species
    )
  ) %>%
  left_join(bac_properties, by = "species") %>% 
  ggplot(aes(x = lfc, y = reorder(species, lfc), col = `Oxygen tolerance`, shape = abn)) +
    geom_point() +
    geom_linerange(aes(xmin = lower, xmax = upper)) +
    geom_vline(xintercept = 0, linetype = "dashed") +
    facet_wrap(~ env) +
    theme_bw() +
    scale_colour_viridis_d(option = "H")

```

Species enriched in saliva compared to model calculus are largely aerobic, while
species enriched in model calculus compared to saliva are mainly anaerobes
[@fig-diffabund-byoc].

### Lower diversity in artificial samples than oral references

```{r}
shan_compar <- alpha_summ_all %>% 
  filter(index == "shannon") # isolate shannon index values

shan_model <- shan_compar %>%
  filter(Env == "byoc_calculus" |
           Env == "medium" |
           Env == "vitro_biofilm")
  
shan_oral <- shan_compar %>%
  filter(Env != "byoc_calculus",
           Env != "medium",
           Env != "vitro_biofilm")
```

<!-- alpha diversity -->
```{r}
#| label: fig-shannon-compar
alpha_div_long %>%
  filter(!Env %in% env_controls,
         index == "shannon") %>%
  mutate(Env = case_when(str_detect(Env, "plaque") ~ "plaque",
                         TRUE ~ Env)) %>%
  ggplot(aes(x = Env, y = value)) +
    geom_violin(aes(col = Env, fill = Env), alpha = 0.5) +
    geom_boxplot(width = 0.1) +
    #facet_wrap(~ index, scales = "free_y") +
    theme_bw() +
    theme(
      axis.title = element_blank(),
      axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1),
      axis.ticks.x = element_blank(),
      panel.grid.major.x = element_blank(),
      legend.position = "none"
    )

```

Again, the Shannon Index was used to evaluate alpha diversity, this time across
model samples and oral reference samples. Model samples
(`r paste("M =", signif(shan_model$mean, 3), collapse = ", ")`)
were consistently lower than oral reference samples
(`r paste("M =", signif(shan_oral$mean, 3), collapse = ", ")`)
in species richness and diversity. The Pielou Species Evenness has a similar
distribution, although the comparative biofilm samples have a higher mean
than biofilm samples from this study (Supp. Mat.)<!--link to supp mat-->.

<!-- beta diversity -->
### Model calculus is distinct from dental calculus and other oral samples

```{r}
#| label: fig-genus-env
#| fig-cap: "Mean relative abundances at the genus level between sample types. NA = other genera."
genus_counts_long %>%
  left_join(dna_metadata, by = c("sample" = "#SampleID")) %>%
  filter(str_detect(Env, "plaque|calculus")) %>%
  group_by(Env, genus) %>%
  summarise(rel_abund = mean(rel_abund)) %>%
  mutate(#rel_abund = count / sum(count),
         genus = case_when(rel_abund < 0.06 ~ NA_character_,
                             TRUE ~ genus),
         label = str_extract(genus, "\\w{2}")
           ) %>%
  #filter(rel_abund > 0.05) %>% 
  ggplot(aes(x = "", y = rel_abund, fill = genus, label = label)) +
    geom_col(col = "grey50") +
    coord_polar(theta = "y", start = 0) +
    geom_label(position = position_stack(vjust = 0.5), col = "white", show.legend = F) +
    facet_wrap(~ Env) +
    theme_void() +
    #scale_fill_manual(viridisLite::viridis())) 
    scale_fill_viridis_d(na.value = "grey50")

```

The main overlap between the model calculus and oral comparative
samples are the high relative abundance of *Streptococcus*.
Model calculus consists mostly of *Enterococcus*
and *Veillonella* spp., while oral comparative samples are more
diverse (consistent with the Shannon Index).

```{r}
#| label: compar-spca-fig-setup
# sPCA plot of PCs 1 and 2
compar_spca_plot <- compar_princomp %>%
  ggplot(aes(x = PC1, y = PC2, col = Env, shape = Env)) +
    geom_point(size = 3) +
    geom_vline(xintercept = 0, size = 0.2) +
    geom_hline(yintercept = 0, size = 0.2) +
    theme_bw() +
    labs(x = paste(
      "PC1", scales::percent(compar_explain_var[[1]], accuracy = 0.1)
      ),
      y = paste(
        "PC2", scales::percent(compar_explain_var[[2]], accuracy = 0.1)
      )
    ) +
  scale_colour_viridis_d(option = "C") +
  scale_shape_manual(values = 1:length(levels(as.factor(compar_princomp$Env))))

# loading plot PC1
compar_comp_1 <- compar_pca_loadings %>%
  arrange(desc(PC1)) %>% 
  mutate(species = fct_reorder(species, desc(PC1))) %>%
  slice(c(
    1:20,
    seq(from = nrow(compar_pca_loadings)-19, to = nrow(compar_pca_loadings))
    )) %>%
  ggplot(aes(x = PC1, y = species, fill = `Oxygen tolerance`)) +
    geom_bar(stat = "identity", width = 0.8) +
    scale_x_continuous(limits = c(min_comp_PC1,max_comp_PC1)) +
  scale_fill_manual(
      values = viridisLite::turbo(
        n = length(levels(as.factor(bac_properties$`Oxygen tolerance`)))
        )
      ) +
    labs(title = "component 1", x = "") +
    loading_theme

# loading plot PC2
compar_comp_2 <- compar_pca_loadings %>%
  arrange(desc(PC2)) %>%
  mutate(species = fct_reorder(species, desc(PC2))) %>%
  slice(c(
    1:20,
    seq(from = nrow(compar_pca_loadings)-19, to = nrow(compar_pca_loadings))
    )) %>%
  ggplot(aes(x = PC2, y = species, fill = `Oxygen tolerance`)) +
    geom_bar(stat = "identity", width = 0.8) +
    scale_x_continuous(limits = c(min_comp_PC2,max_comp_PC2)) +
  scale_fill_manual(
      values = viridisLite::turbo(
        n = length(levels(as.factor(bac_properties$`Oxygen tolerance`)))
        )
      ) +
    labs(title = "component 2", x = "") +
    loading_theme
```

```{r}
compar_spca_plot
compar_comp_1
compar_comp_2
```

Model calculus samples are distinct from both the oral reference samples and
the biofilm model reference samples. They are separated from oral reference samples
mainly on PC1, and from biofilm model reference samples on PC2. The highest
negative contributions are a mix of all types of aerotolerance, while the
positive contributions are mostly (facultative) anaerobes, with *Enterococcus* spp.
as the top three positive contributors to PC1. Top negative contributors are
*Capnocytophaga* spp. The top positive contributors to PC2 are all anaerobes,
mainly from the genus *Selenomonas*. Top negative contributors to PC2 are a mix of
aerotolerances, with many *Streptococcus* spp. 

## FTIR

```{r}
#| label: results-ftir-setup
#| include: false
grind_sample_order <- c( # make sure the grind samples are ordered correctly in plots
  "Archaeological calculus",
  "Artificial calculus day 16",
  "Artificial calculus day 20",
  "Artificial calculus day 24",
  "Archaeological bone",
  "Bone-Dentine",
  "Bone-Dentine_2",
  "Enamel",
  "Enamel_2",
  "Enamel_3")

# Preparation of grind curve plots
grind_all_plot <- ftir_grind_data %>%
  mutate(
    Sample_day = factor(Sample_day, levels = grind_sample_order)) %>% # reorder sampling day levels
  group_by(day, Sample) %>%
    ggplot(aes(x = FWHM, y = IRSF, col = Sample_day, shape = Sample_day)) +
    geom_point(size = 2, alpha = 0.6) +
    geom_smooth(method = "lm", se = F) +
    theme_minimal() +
    labs(col = "Sample", shape = "Sample",
         x = "FWHM of the 1035 peak",
         y = "Splitting factor")
```

```{r}
#| label: fig-experiment-spectra
#| fig-cap: "Select spectra from all experiment sampling days."
#| layout-ncol: 2
#| fig-subcap:
#|  - "A"
#|  - "B"
#|  - "C"
#|  - "D"
# day 7
ftir_data %>%
  filter(
    day == 7,
    sample != "F7",
    sample != "F7.1A6_b"
    ) %>%
  ggplot(aes(x = wavenumber, y = abs, col = sample)) +
    geom_line() +
    theme_classic() +
    scale_x_reverse()

# day 12
ftir_data %>%
  filter(
    day == 12
    #sample != "F7",
    #sample != "F7.1A6_b"
    ) %>%
  ggplot(aes(x = wavenumber, y = abs, col = sample)) +
    geom_line() +
    theme_classic() +
    scale_x_reverse()

# day 16
ftir_data %>%
  filter(
    day == 16,
    is.na(grind),
    sample != "F16.2D2",
    sample != "F16.1D6",
    sample != "F16.1B2"
    ) %>%
  ggplot(aes(x = wavenumber, y = abs, col = sample)) +
    geom_line() +
    theme_classic() +
    scale_x_reverse()

# day 24 (final product)
ftir_data %>%
  filter(
    day == 24,
    is.na(grind),
    str_detect(sample, "[_]", negate = T),
    sample != "F24.1B3",
    sample != "F24.2C3",
    sample != "F24.2D3",
    sample != "F24.2A4",
    ) %>%
  ggplot(aes(x = wavenumber, y = abs, col = sample)) +
    geom_line() +
    theme_classic() +
    scale_x_reverse()
```

<!-- needs to be condensed!! -->
Day 7 spectra have large O--H and amide A absorbance bands in stretching mode
around 3400 cm$^{-1}$, as well as three marked CH~3~ and CH$_2$ stretching
vibrations at 2960, 2920, and 2850 cm$^{-1}$. There is a clear amide I peak at
1650 and a less pronounced amide II peak at 1545 cm$^{-1}$. 
In the 'fingerprint' region, C--O$_3^{2-}$ at 1450 and 1400 absorbance bands
corresponding to the v~3~ asummetric stretching vibrations, P--O~4~ absorbance band
corresponding to the v~3~ asymmetric stretching vibrations
at 1080 cm$^{-1}$, and minor phosphate absorption bands around 500 cm$^{-1}$ in
sample F7.1A6, but absent in sample F7.2D1. The absorption bands at 1080
cm$^{-1}$, and 1040-1047 cm$^{-1}$ and minor bending absorption bands of the
phosphate doublet around 605 cm$^{-1}$ and 560 cm$^{-1}$ in sample F7.2D1, but
absent in sample F7.1A6. The absorption bands at 1080 cm$^{-1}$ could be a C--N
stretching mode from aliphatic amines, but may also come from silicate contamination
(typical quartz doublet at 797, 780).
The relative absorbance of O--H and Amide I and II bands are higher than the
phosphate bands, representing a relatively higher content of lipids and proteins
than inorganic content. Large variation between spectra.

Day 12, amide I and II continue to be the dominant peaks, and a higher ratio
of both amide and O--H to PO~4~ v~3~ absorbance bands.
Three marked CH~3~ and CH$_2$ stretching vibrations at 2960,
2920, and 2850 cm$^{-1}$. Reduced variation between two of the three spectra.

Day 16, the ratio of O--H and amides to PO~4~ has shifted, with
the main peak shifting to the PO~4~ v~3~ absorbance band at 1040
(except in sample F16.1A2). A well-defined PO~4~ doublet at 600 and 560 is
present. Small CO$_3^{2-}$ asymmetric stretching at 1450 cm$^{-1}$ and 1415 cm$^{-1}$,
and stretching vibrations at 875-870 cm$^{-1}$.
Decreased variability between the spectra, with most spectra exhibiting a
higher phosphate-to-protein/lipid ratio.

Day 24, large O--H and amide A absorbance bands in stretching mode around 3400 cm$^{-1}$,
as well as three minor CH~3~ and CH$_2$ stretching vibrations at 2960,
2920, and 2850 cm$^{-1}$.
Main peak of spectra is PO~4~ v~3~ at 1040
cm$^{-1}$, well-defined PO~4~ doublet at 600-550 cm$^{-1}$. Amide I band,
with small amide II and III bands. Carbonate peaks also present.
Very little variation between all of the spectra.



The main difference in the samples across the experiment, with
increasing age, is an
increase in the main PO~4~ v~3~ peak at around 1040 cm$^{-1}$, appearance of
the phosphate doublet around 600 and 560 cm$^{-1}$ between day 12
and 16, an increase in the carbonate peaks at 1458-1450 cm$^{-1}$ and 1415-1420
cm$^{-1}$, an increase
in the ratio of the Amide I/II to peaks at around 1650 and 1540 cm$^{-1}$,
and a reduction of the C--H~2~ and C--H~3~ stretching vibrations at 2960,
2920, and 2850 cm$^{-1}$.

High lipid and protein content consistent with the presence of extracellular
polysaccharides and bacteria within a matrix. Microbial DNA and RNA may be
visible from peaks around 1200--800 cm$^{-1}$ on days 7 and 12, which are
later obscured by the increasing phosphate peak at 1040 cm$^{-1}$
[@jainIsolationCharacterization2013]. The presence of water indicated by
the O--H stretch is also consistent with a biofilm, which is around 90%
water [@bergerOralBiofilms2018]. As the samples mature, the ratio of proteins
and lipids to phosphates shift from predominance of organic content to
inorganic content in the form of carbonated hydroxyapatite.

Early spectra, days 7 and 12, are also similar to collagen spectra, with the
OH absorbance band at around 3400 cm$^{-1}$, amide I, II, and III peaks at
1659, 1552, and 1240 cm$^{-1}$, respectively 
[@rohanizadehUltrastructuralStudy2005; @martinezcortizasLinkingStructural2020].

The archaeological and modern reference spectra are largely indistinguishable and
consist of an O--H absorbance band (3400 cm$^{-1}$), CH~3~ bands (3000--2900 cm$^{-1}$),
carbonate (1420, 1458-1450, 875-870 cm$^{-1}$), amide I band (1650 cm$^{-1}$), and phosphates
(1040, 604, 566 cm$^{-1}$).

The biofilm samples from the end of the experiment are similar to both reference
samples. The main
difference is a lower organic component in reference samples seen as a reduced
amide I peak at around 1637 compared to the carbonate peak at around 1420, and
an absence of amide II and III. Also a reduction in CH~3~ bands at 3000-2900 cm$^{-1}$.

### Grinding curves

```{r message=FALSE, warning=FALSE}
#| label: fig-grind-curve-inset
#| fig-cap: "(A) Grinding curves of multiple materials; and (B) calculus-only materials, including biofilm samples from three days, and an archaeological calclulus sample."
# produce plot with grind curve for all samples
grind_all_plot <- ftir_grind_data %>%
  mutate(
    Sample_day = factor(Sample_day, levels = grind_sample_order)) %>%
  group_by(day, Sample) %>%
    ggplot(aes(x = FWHM, y = IRSF, col = Sample_day, shape = Sample_day)) +
    geom_point(size = 2, alpha = 0.6) +
    geom_smooth(method = "lm", se = F) +
    theme_minimal() +
    labs(col = "Sample", shape = "Sample",
         x = "FWHM of the 1035 peak",
         y = "Splitting factor")

# isolate calculus samples to see diffs between days and the 'real deal'
grind_calc_plot <- ftir_grind_data %>%
  filter(Sample == "Artificial calculus" | Sample == "Archaeological calculus") %>%
  ggplot(aes(x = FWHM, y = IRSF, col = Sample_day, shape = Sample_day)) +
    geom_point(size = 2, alpha = 0.6) +
    geom_smooth(method = "lm", se = F) +
    labs(col = "Sample", shape = "Sample",
         x = "FWHM of the 1035 peak",
         y = "Splitting factor") +
    theme_minimal() +
    theme(
      axis.text = element_blank(),
      axis.title = element_blank(),
      axis.ticks = element_blank(),
      legend.position = "none",
      panel.border = element_rect(
        colour = "grey", 
        fill = "transparent", size = 1),
      panel.background = element_rect(fill = "white")
      ) +
    scale_colour_viridis_d(end = 0.4)

grind_all_plot + inset_element(grind_calc_plot, left = 0.5, bottom = 0.5, right = 1, top = 1) + 
  plot_layout(guides = "collect") + plot_annotation(tag_levels = "A")
```

<!-- FTIR spectra comparison of artificial and reference dental calculus -->

Samples were compared to the results of @asscherAtomicDisorder2011 and
@asscherVariationsAtomic2011, and the slopes
of the trend lines for our model calculus are similar to those of fresh bone and
dentin. No appreciable differences between days 16, 20, and 24. The archaeological
dental calculus does show a slightly increased slope compared to model calculus
from the three sampling days used in the grind curve.
